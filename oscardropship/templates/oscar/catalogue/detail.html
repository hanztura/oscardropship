{% extends "uikit/layout.html" %}

{% load history_tags %}
{% load currency_filters %}
{% load reviews_tags %}
{% load product_tags %}
{% load display_tags %}
{% load i18n %}
{% load purchase_info_tags %}
{% load static %}
{% load easy_thumbnails_tags %}

{% block title %}
    {{ product.get_title }} | {{ block.super }}
{% endblock %}

{% block description %}
    {{ product.description|default:""|striptags }}
{% endblock %}

{% block breadcrumbs %}
    <nav class="uk-child-width-expand uk-padding-large uk-padding-remove-vertical" uk-grid>
        <div>
            <ul class="uk-breadcrumb">
                <li><a href="{% url 'home' %}">{% trans "Home" %}</a></li>
                {% with category=product.get_categories.first %}
                    {% for c in category.get_ancestors_and_self %}
                        <li>
                            <a href="{{ c.get_absolute_url }}">{{ c.name }}</a>
                        </li>
                    {% endfor %}
                    <li>{{ product.get_title|truncatechars:20 }}</li>
                {% endwith %}
            </ul>
        </div>
    </nav>
{% endblock %}

{% block content_wrapper %}
    <section class="uk-child-width-1-2@m" uk-grid>
        {# Product Images #}
        {% with product.get_all_images as all_images %}
            <div>
                <div
                    x-data="slideshow()"
                    style="z-index: 980"
                    uk-sticky="bottom: #additonalInformation; top: 100"
                    uk-grid>
                    {# thumbnav #}
                    <div class="uk-width-1-4@s uk-visible@l">
                        <ul class="uk-thumbnav uk-thumbnav-vertical" uk-margin>
                            {% for image in all_images %}
                                {% with counter=forloop.counter|add:'-1' %}
                                    <li :class="{ 'uk-active': index == {{ counter }} }"><a @mouseenter="changeIndex({{ counter }})"><img src="{% thumbnail image.original 100x124 %}" width="100" alt=""></a></li>
                                    
                                {% endwith %}
                            {% endfor %}
                        </ul>
                    </div>

                    {# image display #}
                    <div class="uk-width-expand">
                        <div x-ref="itemSlideshow" class="uk-position-relative uk-visible-toggle uk-light" tabindex="-1" uk-slideshow="min-height: 500;">
                            <ul class="uk-slideshow-items">
                                {% for image in all_images %}
                                    <li>
                                        <img src="{{ image.original.url }}" alt="" uk-cover>
                                    </li>
                                {% endfor %}
                                <li>
                            </ul>

                            <a class="uk-position-center-left uk-position-small uk-hidden-hover" href="#" uk-slidenav-previous uk-slideshow-item="previous"></a>
                            <a class="uk-position-center-right uk-position-small uk-hidden-hover" href="#" uk-slidenav-next uk-slideshow-item="next"></a>
                        </div>
                    </div>
                </div>
            </div>
        {% endwith %}

        {# Details #}
        <div>
            {% purchase_info_for_product request product as session %}

            <p class="{{ session.availability.code }} availability">
                Availability: 
                <i uk-icon="icon: {% if session.availability.is_available_to_buy %}check{% else %}close{% endif %}"></i>
                {{ session.availability.message }}
            </p>
            <h1>{{ product.get_title }}</h1>


            {% if session.price.exists %}
                {% if session.price.excl_tax == 0 %}
                    <p class="price_color">{% trans "Free" %}</p>
                {% elif session.price.is_tax_known %}
                    <p class="price_color">{{ session.price.incl_tax|currency:session.price.currency }}</p>
                {% else %}
                    <p class="price_color">{{ session.price.excl_tax|currency:session.price.currency }}</p>
                {% endif %}
            {% else %}
                <p class="price_color">&nbsp;</p>
            {% endif %}

            {% iffeature "reviews" %}
                {% include "uikit/catalogue/reviews/partials/review_stars.html" %}
            {% endiffeature %}

            <div class="uk-child-width-auto uk-flex uk-flex-between" uk-grid>
                <div>
                    <span>
                        <i uk-icon="icon: heart"></i>
                        Shipping
                    </span>
                </div>
                <div>
                    <span>
                        <i uk-icon="icon: mail"></i>
                        Ask about this product
                    </span>
                </div>
            </div>

            {# quantity and buy now #}
            <div class="uk-flex uk-flex-between" x-data="buyForm()" uk-grid>
                <div class="uk-width-1-1">
                    <div class="uk-form-controls uk-form-controls-text">
                        <label><input x-model="isAgree" class="uk-checkbox" type="checkbox" name="is_agree"> I agree with the terms and conditions</label><br>
                    </div>
                </div>
                <div class="uk-width-1-3@m">
                    <div class="uk-inline">
                        <a @click="updateQuantity(-1)" class="uk-form-icon" href="#!" uk-icon="icon: minus"></a>
                        <a @click="updateQuantity(1)" class="uk-form-icon uk-form-icon-flip" href="#!" uk-icon="icon: plus"></a>
                        <input
                            x-model.number="quantity"
                            class="uk-input uk-width-1-1 uk-text-center"
                            type="number"
                            name="quantity">
                    </div>
                </div>
                <div class="uk-width-expand">
                    <button class="uk-button uk-button-primary uk-width-1-1">BUY NOW</button>
                </div>
            </div>

            {# description #}
            <div class="uk-width-expand" uk-grid>
                <div>
                    {{ product.description|safe }}
                </div>
            </div>

            {# additonal information #}
            <hr>
            <div class="uk-child-width-expand" uk-grid id="additonalInformation">
                <div>
                    <h2>ADDITIONAL INFORMATION</h2>
                    <table class="uk-table">
                        <tbody>
                            {% for av in product.attribute_values.all %}
                                <tr>
                                    <th class="uk-table-shrink">{{ av.attribute.name }}:</th>
                                    <td class="uk-table-expand">{{ av.value_as_html }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            {# reviews #}
            <hr>
            <div class="uk-child-width-expand" uk-grid>
                <div>
                    <p><strong>REVIEWS</strong></p>
                    <h2>CUSTOMER REVIEWS</h2>

                    {% iffeature "reviews" %}
                        <tr>
                            <th>{% include "uikit/catalogue/reviews/partials/review_stars.html" %}</th>
                            <td>{% trans "Based on " %} {{ product.num_approved_reviews }} {% trans "reviews" %}</td>
                        </tr>
                    {% endiffeature %}
                </div>
            </div>
        </div>
    </section>

    <div class="uk-flex-center" uk-grid id="socialMediaLinks">
        <div>
            <a class="uk-text-default" href="#!"><span uk-icon="icon: facebook"></span></a>
            <a class="uk-text-default" href="#!"><span uk-icon="icon: instagram"></span></a>
            <a class="uk-text-default" href="#!"><span uk-icon="icon: pinterest"></span></a>
        </div>
    </div>
{% endblock content_wrapper %}

{% block extrascripts %}
    <script>
        function slideshow() {
            return {
                index: 0,
                changeIndex(index) {
                    this.index = index;
                    UIkit.slideshow(this.$refs.itemSlideshow).show(this.index);
                }
            }
        }

        function buyForm() {
            return {
                quantity: 1,
                isAgree: false,
                updateQuantity(num) {
                    this.quantity += num;
                }
            }
        }
    </script>
    {{ block.super }}
{% endblock %}

{% block styles %}
    {{ block.super }}    
    <style>
        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        /* Firefox */
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
{% endblock styles %}